Arquitectura de Datos: Nelux (Estructura Real - v2.0)
El sistema se basa ahora en tablas principales optimizadas. Aunque nombre_barberia se usa para slugs y relaciones legadas, el id (UUID) es la clave principal para las Políticas de Seguridad (RLS) y relaciones eficientes.

1. Tabla "perfiles" (Configuración Master y Horarios)
Es la tabla maestra. Ahora incluye el horario de apertura para evitar consultas extra.

Identidad y Acceso:

id (UUID): Identificador único (vinculado a auth.users).

nombre_barberia: (PK lógica) Identificador legible.

slug: (String, Unique) URL amigable para el perfil público (wolf_barbershop).

correo / telefono: Datos de contacto.

nombre_encargado: Responsable legal.

twiliio: Número para automatizaciones n8n.

Configuración y Lógica de Negocio:

horario_semanal (JSONB - NUEVO): Array de objetos con la configuración de apertura de la tienda.

Estructura: [{ "dia": 1, "abierto": true, "franjas": [{ "inicio": "09:00", "fin": "14:00" }] }]

onboarding_completado: (Boolean) Control de flujo inicial.

capacidad_slots: (Int) Cantidad de citas simultáneas posibles.

configuracion: (JSONB/Columnas) Dirección, info extra, etc.

Suscripción (Stripe):

plan: 'basico' | 'profesional' | 'premium'.

estado: 'active' | 'past_due' | 'trialing'.

stripe_customer_id: ID de cliente (cus_xxx).

KPIs (Cálculo Automático):

objetivo_ingresos, objetivo_citas: Metas mensuales.

ingresos_dia, cortes_dia: Métricas en tiempo real.

2. Tabla "citas" (Agenda Inteligente)
Registro central de reservas y transacciones.

Identificadores:

id: (Int8) ID único de la cita.

user_id / barberia_id: (UUID) Vincula con perfiles.id (Crucial para RLS).

barberia: (Text) Vincula con perfiles.nombre_barberia (Legado).

created_at: Timestamp.

Detalles de la Cita:

nombre: Nombre del cliente.

telefono: Contacto del cliente.

servicio_id: (UUID) Vincula con tabla servicios.

servicio: (Text) Nombre del servicio snapshot (por si cambia el precio futuro).

precio: (Numeric) Coste final.

fecha (Date) y hora (Time): Cuándo ocurre.

barbero: (Text/UUID) NUEVO: Nombre o ID del barbero específico asignado (Visible solo en planes Premium).

Seguridad y Estado:

ip_address: (Text) Dirección IP del cliente para Rate Limiting y bloqueos.

confirmada: (Bool) Cita activa.

cancelada: (Bool) No-show o cancelación manual.

automatica: (Bool) true = App Cliente, false = Manual Barbero.

3. Tabla "barberos" (Staff y Turnos Flexibles)
Optimizada para soportar turnos partidos, días libres rotativos y horarios complejos.

Datos:

id: (UUID/Int) Identificador.

barberia_id: (UUID) Vincula con perfiles.id.

nombre: Nombre del empleado.

foto: (Text) URL de su foto de perfil (Opcional).

Horario Inteligente:

horario_semanal (JSONB - NUEVO): Sustituye a todas las columnas antiguas de inicio_turno, fin_turno, etc.

Estructura: Array de 7 objetos. Permite múltiples turnos por día (ej: mañana y tarde).

Ejemplo: [{ "dia": 1, "activo": true, "turnos": [{ "inicio": "10:00", "fin": "14:00" }, { "inicio": "16:00", "fin": "20:00" }] }]

4. Tabla "servicios" (Catálogo)
id: (UUID).

perfil_id: (UUID).

nombre: (Text) "Corte Clásico".

precio: (Numeric).

duracion: (Int) Minutos que ocupa en la agenda.

5. Tabla "productos" (Inventario Tienda)
id: (Int).

barberia_id: (UUID).

nombre: "Cera Mate".

precio: Precio de venta.

stock: Cantidad actual.

venta: Histórico vendido.

foto: (Text) URL Storage.

6. Tabla "ventas_productos" (Historial Ventas)
Registro inmutable de ventas físicas.

id: (UUID).

barberia_id: (UUID).

nombre_producto: Snapshot del nombre.

precio: Precio al momento de la venta.

cantidad: Unidades.

created_at: Fecha.

7. Tabla "mensajes" (Chat & Auditoría)
id: (Int).

barberia: Vincula con perfil.

tlf: ID de conversación (Teléfono cliente).

mensaje_enviado / mensaje_recibido: Contenido.

manual: (Bool) true si intervino el humano, false si fue la IA.

8. Nuevas Tablas de Seguridad y Marketing
Tabla "rate_limits" (Seguridad)
Controla el abuso del sistema mediante IPs.

ip: (Text) PK. La dirección IP del usuario.

attempts: (Int) Contador de intentos en la última hora.

last_attempt: (Timestamp) Última vez que intentó reservar.